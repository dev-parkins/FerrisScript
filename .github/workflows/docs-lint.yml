name: Documentation Linting

on:
  pull_request:
    branches:
      - main
    paths:
      - '**.md'
      - 'docs/**'
      - '.github/workflows/docs-lint.yml'
      - '.markdownlint.json'
      - '.markdown-link-check.json'
  push:
    branches: 
      - main
    paths:
      - '**.md'
      - 'docs/**'

jobs:
  markdown-lint:
    name: Markdown Linting
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Run markdownlint
        uses: nosborn/github-action-markdown-cli@508d6cefd8f0cc99eab5d2d4685b1d5f470042c1
        with:
          files: .
          config_file: .markdownlint.json

  link-check:
    name: Markdown Link Check
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Install markdown-link-check
        run: npm install -g markdown-link-check

      - name: Check markdown links (excluding archive)
        run: |
          find . -name "*.md" \
            -not -path "*/docs/archive/*" \
            -not -path "*/target/*" \
            -not -path "*/node_modules/*" \
            -exec markdown-link-check {} --config .markdown-link-check.json --quiet \;
