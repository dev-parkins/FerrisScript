# FerrisScript v0.0.5 Roadmap 🦀

**Version**: 0.0.5 (Patch Release)  
**Focus**: LSP Alpha  
**Timeline**: 4-5 weeks  
**Prerequisites**: v0.0.4 (complete editor + API foundation)

---

## 🎯 Overview

**Strategic Goal**: Implement Language Server Protocol for first-class editor experience.

**Key Priorities**:

1. LSP server implementation
2. VS Code LSP integration
3. Real-time diagnostics and autocomplete
4. Foundation for advanced IDE features

**Alignment with v0.1.0 Strategy**: **HIGHEST PRIORITY** feature in reprioritized roadmap. Transforms FerrisScript into a professional development language with modern IDE support.

**This is the most critical release** toward v0.1.0, as it delivers the #1 priority: first-class editor integration via LSP.

---

## 📦 Critical Priority Deliverables

### 1. LSP Server Implementation 🔥🔥🔥

**Status**: Not Started  
**Priority**: 🔥 **CRITICAL** (Highest priority in v0.1.0 roadmap)

**Rationale**: Makes FerrisScript a real development language. Enables professional IDE experience that attracts developers and accelerates adoption.

**Scope**:

#### Phase 1: Basic LSP Server (Week 1-2)

- [ ] Create LSP server project structure
- [ ] Implement LSP protocol handler using `tower-lsp` crate
- [ ] Set up server initialization and capabilities
- [ ] Implement text document synchronization
- [ ] Handle document open/close/change events
- [ ] Basic server logging and debugging

#### Phase 2: Syntax Checking (Week 2)

- [ ] Integrate FerrisScript compiler:
  - Lexer integration
  - Parser integration
  - Type checker integration
- [ ] Real-time syntax error detection
- [ ] Publish diagnostics to client
- [ ] Map compiler errors to LSP diagnostic format
- [ ] Handle incremental document changes

**Example**:

```rust
// User types this in editor:
let x: i32 = "hello";

// LSP immediately shows:
Error[E203]: Type mismatch
  --> example.ferris:1:14
   |
 1 | let x: i32 = "hello";
   |              ^^^^^^^ expected i32, found String
```

#### Phase 3: Autocomplete (Week 3)

- [ ] Implement completion provider
- [ ] Complete keywords:
  - `let`, `let mut`, `fn`, `if`, `else`, `while`, `return`
- [ ] Complete types:
  - `i32`, `f32`, `bool`, `String`, `Vector2`, `Node`, `Color`, etc.
- [ ] Complete built-in functions:
  - `print`, `get_node`, `get_parent`, `has_node`, `emit_signal`
- [ ] Complete user-defined variables
- [ ] Complete user-defined functions
- [ ] Context-aware completion (scope-based)
- [ ] Completion snippets with placeholders

**Example**:

```rust
// User types: "fn "
// LSP suggests:
fn _ready() {
    $0
}

fn _process(delta: f32) {
    $0
}

fn ${1:name}(${2:params}) {
    $0
}
```

#### Phase 4: Go to Definition (Week 3-4)

- [ ] Implement definition provider
- [ ] Jump to variable definition
- [ ] Jump to function definition
- [ ] Jump to type definition
- [ ] Cross-file navigation (if applicable)
- [ ] Definition preview on hover

#### Phase 5: Hover Documentation (Week 4)

- [ ] Implement hover provider
- [ ] Show type information for variables:

  ```
  // Hovering over 'x':
  let x: i32 = 42;
  
  // Shows: (variable) x: i32
  ```

- [ ] Show function signatures:

  ```
  // Hovering over 'print':
  print("Hello");
  
  // Shows: fn print(value: String)
  ```

- [ ] Show documentation for built-in types
- [ ] Show documentation for Godot types
- [ ] Format hover content as Markdown

**Estimated Effort**: 10-15 days

**Technical Stack**:

- `tower-lsp` - LSP protocol implementation
- `tokio` - Async runtime
- `serde` - JSON serialization
- FerrisScript compiler crates (lexer, parser, type checker)

**Components Affected**: New crate: `ferrisscript_lsp`

---

### 2. VS Code LSP Integration

**Status**: Not Started  
**Priority**: Critical

**Prerequisites**: LSP server implementation (Phase 1-2)

**Scope**:

- [ ] Update VS Code extension to use LSP client
- [ ] Configure LSP client connection
- [ ] Start LSP server automatically
- [ ] Handle server lifecycle (start/stop/restart)
- [ ] Configure server settings (port, log level, etc.)
- [ ] Add extension commands:
  - Restart LSP server
  - Show server logs
  - Check server status
- [ ] Handle server crashes gracefully
- [ ] Extension activation on `.ferris` files

**VS Code Extension Updates**:

- [ ] Remove static completion (replaced by LSP)
- [ ] Remove static hover (replaced by LSP)
- [ ] Keep syntax highlighting (complementary)
- [ ] Keep snippets (complementary)
- [ ] Update marketplace description
- [ ] Add screenshots showing LSP features

**Estimated Effort**: 3-4 days

**Dependencies**: npm, VS Code Extension API, vscode-languageclient

---

## 📊 Success Metrics

### Quantitative Goals

- [ ] LSP server responds to requests in < 100ms
- [ ] Real-time error checking works
- [ ] Autocomplete provides 20+ suggestions
- [ ] Go to definition works for all symbols
- [ ] Hover shows information for all types
- [ ] VS Code extension rated 4+ stars

### Qualitative Goals

- [ ] Developers describe experience as "modern"
- [ ] Error detection feels instant
- [ ] Autocomplete feels intuitive
- [ ] IDE features rival mainstream languages
- [ ] FerrisScript development is productive

---

## 📋 Task Breakdown

### Week 1: LSP Foundation

- Day 1-2: LSP server project setup
- Day 3-4: Protocol handler and initialization
- Day 5-7: Text synchronization and basic diagnostics

### Week 2: Syntax Checking & Diagnostics

- Day 1-2: Compiler integration
- Day 3-4: Error mapping and diagnostics
- Day 5-7: Incremental parsing and testing

### Week 3: Autocomplete & Definitions

- Day 1-3: Completion provider
- Day 4-5: Context-aware suggestions
- Day 6-7: Go to definition implementation

### Week 4: Hover & Integration

- Day 1-2: Hover provider
- Day 3-4: VS Code integration
- Day 5-7: Testing and bug fixes

### Week 5 (Buffer/Polish)

- Day 1-2: Performance optimization
- Day 3-4: Edge case handling
- Day 5: Documentation and release

---

## 🔗 Dependencies for Next Version

**Enables v0.0.6-7 and v0.1.0**:

- ✅ LSP working → Developer productivity soars
- ✅ First-class editor → Attracts more contributors
- ✅ Real-time feedback → Faster development of language features
- ✅ Professional tooling → Ready for v0.1.0 release

**Critical Path**:

v0.0.4 (Godot API) → v0.0.5 (LSP) → v0.0.6 (Language Features) → v0.1.0

---

## 📝 Notes

### LSP Architecture

```
┌─────────────────────────────────────────┐
│           VS Code Client                │
│  (Extension using vscode-languageclient)│
└────────────────┬────────────────────────┘
                 │ JSON-RPC over stdio
                 │
┌────────────────▼────────────────────────┐
│       FerrisScript LSP Server           │
│                                         │
│  ┌─────────────────────────────────┐   │
│  │   tower-lsp                     │   │
│  │   (Protocol Handler)            │   │
│  └──────────────┬──────────────────┘   │
│                 │                       │
│  ┌──────────────▼──────────────────┐   │
│  │  FerrisScript Compiler          │   │
│  │  - Lexer                        │   │
│  │  - Parser                       │   │
│  │  - Type Checker                 │   │
│  └─────────────────────────────────┘   │
└─────────────────────────────────────────┘
```

### Testing Strategy

1. **Unit Tests**: Test each LSP feature independently
2. **Integration Tests**: Test LSP server with mock client
3. **Manual Testing**: Test in VS Code with real scripts
4. **Performance Tests**: Measure response times
5. **Stress Tests**: Test with large files

### Known Challenges

1. **Incremental Parsing**: Efficiently re-parsing on document changes
2. **Performance**: Keeping diagnostics fast for large files
3. **State Management**: Tracking multiple open documents
4. **Error Recovery**: Handling invalid syntax gracefully
5. **Async Complexity**: Managing tokio runtime

### Future Enhancements (Post-v0.0.5)

These could be added in v0.0.6 or later:

- [ ] Rename symbol
- [ ] Find references
- [ ] Document symbols (outline view)
- [ ] Workspace symbols (global search)
- [ ] Code actions (quick fixes)
- [ ] Semantic highlighting
- [ ] Inlay hints (type annotations)
- [ ] Call hierarchy
- [ ] Signature help

### Release Checklist

- [ ] All LSP features working
- [ ] VS Code extension updated
- [ ] Extension published to marketplace
- [ ] LSP server binary included
- [ ] Documentation updated with LSP setup
- [ ] Demo video showing LSP features
- [ ] Blog post about LSP implementation
- [ ] CHANGELOG.md updated
- [ ] Version numbers bumped
- [ ] Tag created: v0.0.5
- [ ] GitHub release created

### Communication

- [ ] Major announcement: "LSP Support Arrives"
- [ ] Demo video showing autocomplete and diagnostics
- [ ] Blog post explaining LSP architecture
- [ ] Tweet with side-by-side comparison (before/after)
- [ ] Request community testing and feedback
- [ ] Celebrate milestone achievement

---

## 🚫 Out of Scope

The following are explicitly **NOT** included in v0.0.5:

- ❌ Advanced LSP features (rename, find references, etc.)
- ❌ Debugger integration
- ❌ New language features (arrays, loops, match)
- ❌ Hot reload
- ❌ Multi-file projects (initial focus on single file)
- ❌ Custom LSP extensions

These features are deferred to future versions or v0.1.0.

---

**Last Updated**: October 2025  
**Status**: 🟡 Planning  
**Previous Version**: v0.0.4 (Godot API Expansion)  
**Next Version**: v0.0.6 (Language Features - Optional)
